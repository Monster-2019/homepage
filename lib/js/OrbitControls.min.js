import{EventDispatcher,MOUSE,Quaternion,Spherical,TOUCH,Vector2,Vector3}from"./three.module.js";var OrbitControls=function(e,t){if(t===undefined)console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.');if(t===document)console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.');this.object=e;this.domElement=t;this.enabled=true;this.target=new Vector3;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.enableDamping=false;this.dampingFactor=.05;this.enableZoom=true;this.zoomSpeed=1;this.enableRotate=true;this.rotateSpeed=1;this.enablePan=true;this.panSpeed=1;this.screenSpacePanning=true;this.keyPanSpeed=7;this.autoRotate=false;this.autoRotateSpeed=2;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={LEFT:MOUSE.ROTATE,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.PAN};this.touches={ONE:TOUCH.ROTATE,TWO:TOUCH.DOLLY_PAN};this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=this.object.zoom;this._domElementKeyEvents=null;this.getPolarAngle=function(){return d.phi};this.getAzimuthalAngle=function(){return d.theta};this.listenToKeyEvents=function(e){e.addEventListener("keydown",re);this._domElementKeyEvents=e};this.saveState=function(){u.target0.copy(u.target);u.position0.copy(u.object.position);u.zoom0=u.object.zoom};this.reset=function(){u.target.copy(u.target0);u.object.position.copy(u.position0);u.object.zoom=u.zoom0;u.object.updateProjectionMatrix();u.dispatchEvent(m);u.update();p=h.NONE};this.update=function(){var o=new Vector3;var r=(new Quaternion).setFromUnitVectors(e.up,new Vector3(0,1,0));var i=r.clone().invert();var s=new Vector3;var c=new Quaternion;var l=2*Math.PI;return function e(){var t=u.object.position;o.copy(t).sub(u.target);o.applyQuaternion(r);d.setFromVector3(o);if(u.autoRotate&&p===h.NONE){L(H())}if(u.enableDamping){d.theta+=b.theta*u.dampingFactor;d.phi+=b.phi*u.dampingFactor}else{d.theta+=b.theta;d.phi+=b.phi}var n=u.minAzimuthAngle;var a=u.maxAzimuthAngle;if(isFinite(n)&&isFinite(a)){if(n<-Math.PI)n+=l;else if(n>Math.PI)n-=l;if(a<-Math.PI)a+=l;else if(a>Math.PI)a-=l;if(n<=a){d.theta=Math.max(n,Math.min(a,d.theta))}else{d.theta=d.theta>(n+a)/2?Math.max(n,d.theta):Math.min(a,d.theta)}}d.phi=Math.max(u.minPolarAngle,Math.min(u.maxPolarAngle,d.phi));d.makeSafe();d.radius*=v;d.radius=Math.max(u.minDistance,Math.min(u.maxDistance,d.radius));if(u.enableDamping===true){u.target.addScaledVector(E,u.dampingFactor)}else{u.target.add(E)}o.setFromSpherical(d);o.applyQuaternion(i);t.copy(u.target).add(o);u.object.lookAt(u.target);if(u.enableDamping===true){b.theta*=1-u.dampingFactor;b.phi*=1-u.dampingFactor;E.multiplyScalar(1-u.dampingFactor)}else{b.set(0,0,0);E.set(0,0,0)}v=1;if(O||s.distanceToSquared(u.object.position)>f||8*(1-c.dot(u.object.quaternion))>f){u.dispatchEvent(m);s.copy(u.object.position);c.copy(u.object.quaternion);O=false;return true}return false}}();this.dispose=function(){u.domElement.removeEventListener("contextmenu",le);u.domElement.removeEventListener("pointerdown",ee);u.domElement.removeEventListener("wheel",oe);u.domElement.removeEventListener("touchstart",ie);u.domElement.removeEventListener("touchend",ce);u.domElement.removeEventListener("touchmove",se);u.domElement.ownerDocument.removeEventListener("pointermove",R);u.domElement.ownerDocument.removeEventListener("pointerup",Y);if(u._domElementKeyEvents!==null){u._domElementKeyEvents.removeEventListener("keydown",re)}};var u=this;var m={type:"change"};var n={type:"start"};var a={type:"end"};var h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};var p=h.NONE;var f=1e-6;var d=new Spherical;var b=new Spherical;var v=1;var E=new Vector3;var O=false;var o=new Vector2;var r=new Vector2;var i=new Vector2;var s=new Vector2;var c=new Vector2;var l=new Vector2;var g=new Vector2;var T=new Vector2;var y=new Vector2;function H(){return 2*Math.PI/60/60*u.autoRotateSpeed}function P(){return Math.pow(.95,u.zoomSpeed)}function L(e){b.theta-=e}function w(e){b.phi-=e}var A=function(){var a=new Vector3;return function e(t,n){a.setFromMatrixColumn(n,0);a.multiplyScalar(-t);E.add(a)}}();var N=function(){var a=new Vector3;return function e(t,n){if(u.screenSpacePanning===true){a.setFromMatrixColumn(n,1)}else{a.setFromMatrixColumn(n,0);a.crossVectors(u.object.up,a)}a.multiplyScalar(t);E.add(a)}}();var M=function(){var i=new Vector3;return function e(t,n){var a=u.domElement;if(u.object.isPerspectiveCamera){var o=u.object.position;i.copy(o).sub(u.target);var r=i.length();r*=Math.tan(u.object.fov/2*Math.PI/180);A(2*t*r/a.clientHeight,u.object.matrix);N(2*n*r/a.clientHeight,u.object.matrix)}else if(u.object.isOrthographicCamera){A(t*(u.object.right-u.object.left)/u.object.zoom/a.clientWidth,u.object.matrix);N(n*(u.object.top-u.object.bottom)/u.object.zoom/a.clientHeight,u.object.matrix)}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.");u.enablePan=false}}}();function j(e){if(u.object.isPerspectiveCamera){v/=e}else if(u.object.isOrthographicCamera){u.object.zoom=Math.max(u.minZoom,Math.min(u.maxZoom,u.object.zoom*e));u.object.updateProjectionMatrix();O=true}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.");u.enableZoom=false}}function C(e){if(u.object.isPerspectiveCamera){v*=e}else if(u.object.isOrthographicCamera){u.object.zoom=Math.max(u.minZoom,Math.min(u.maxZoom,u.object.zoom/e));u.object.updateProjectionMatrix();O=true}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.");u.enableZoom=false}}function k(e){o.set(e.clientX,e.clientY)}function U(e){g.set(e.clientX,e.clientY)}function D(e){s.set(e.clientX,e.clientY)}function x(e){r.set(e.clientX,e.clientY);i.subVectors(r,o).multiplyScalar(u.rotateSpeed);var t=u.domElement;L(2*Math.PI*i.x/t.clientHeight);w(2*Math.PI*i.y/t.clientHeight);o.copy(r);u.update()}function V(e){T.set(e.clientX,e.clientY);y.subVectors(T,g);if(y.y>0){j(P())}else if(y.y<0){C(P())}g.copy(T);u.update()}function I(e){c.set(e.clientX,e.clientY);l.subVectors(c,s).multiplyScalar(u.panSpeed);M(l.x,l.y);s.copy(c);u.update()}function _(){}function z(e){if(e.deltaY<0){C(P())}else if(e.deltaY>0){j(P())}u.update()}function X(e){var t=false;switch(e.keyCode){case u.keys.UP:M(0,u.keyPanSpeed);t=true;break;case u.keys.BOTTOM:M(0,-u.keyPanSpeed);t=true;break;case u.keys.LEFT:M(u.keyPanSpeed,0);t=true;break;case u.keys.RIGHT:M(-u.keyPanSpeed,0);t=true;break}if(t){e.preventDefault();u.update()}}function S(e){if(e.touches.length==1){o.set(e.touches[0].pageX,e.touches[0].pageY)}else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX);var n=.5*(e.touches[0].pageY+e.touches[1].pageY);o.set(t,n)}}function F(e){if(e.touches.length==1){s.set(e.touches[0].pageX,e.touches[0].pageY)}else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX);var n=.5*(e.touches[0].pageY+e.touches[1].pageY);s.set(t,n)}}function Z(e){var t=e.touches[0].pageX-e.touches[1].pageX;var n=e.touches[0].pageY-e.touches[1].pageY;var a=Math.sqrt(t*t+n*n);g.set(0,a)}function K(e){if(u.enableZoom)Z(e);if(u.enablePan)F(e)}function B(e){if(u.enableZoom)Z(e);if(u.enableRotate)S(e)}function G(e){if(e.touches.length==1){r.set(e.touches[0].pageX,e.touches[0].pageY)}else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX);var n=.5*(e.touches[0].pageY+e.touches[1].pageY);r.set(t,n)}i.subVectors(r,o).multiplyScalar(u.rotateSpeed);var a=u.domElement;L(2*Math.PI*i.x/a.clientHeight);w(2*Math.PI*i.y/a.clientHeight);o.copy(r)}function W(e){if(e.touches.length==1){c.set(e.touches[0].pageX,e.touches[0].pageY)}else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX);var n=.5*(e.touches[0].pageY+e.touches[1].pageY);c.set(t,n)}l.subVectors(c,s).multiplyScalar(u.panSpeed);M(l.x,l.y);s.copy(c)}function q(e){var t=e.touches[0].pageX-e.touches[1].pageX;var n=e.touches[0].pageY-e.touches[1].pageY;var a=Math.sqrt(t*t+n*n);T.set(0,a);y.set(0,Math.pow(T.y/g.y,u.zoomSpeed));j(y.y);g.copy(T)}function Q(e){if(u.enableZoom)q(e);if(u.enablePan)W(e)}function J(e){if(u.enableZoom)q(e);if(u.enableRotate)G(e)}function $(){}function ee(e){if(u.enabled===false)return;switch(e.pointerType){case"mouse":case"pen":te(e);break}}function R(e){if(u.enabled===false)return;switch(e.pointerType){case"mouse":case"pen":ne(e);break}}function Y(e){switch(e.pointerType){case"mouse":case"pen":ae(e);break}}function te(e){e.preventDefault();u.domElement.focus?u.domElement.focus():window.focus();var t;switch(e.button){case 0:t=u.mouseButtons.LEFT;break;case 1:t=u.mouseButtons.MIDDLE;break;case 2:t=u.mouseButtons.RIGHT;break;default:t=-1}switch(t){case MOUSE.DOLLY:if(u.enableZoom===false)return;U(e);p=h.DOLLY;break;case MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(u.enablePan===false)return;D(e);p=h.PAN}else{if(u.enableRotate===false)return;k(e);p=h.ROTATE}break;case MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(u.enableRotate===false)return;k(e);p=h.ROTATE}else{if(u.enablePan===false)return;D(e);p=h.PAN}break;default:p=h.NONE}if(p!==h.NONE){u.domElement.ownerDocument.addEventListener("pointermove",R);u.domElement.ownerDocument.addEventListener("pointerup",Y);u.dispatchEvent(n)}}function ne(e){if(u.enabled===false)return;e.preventDefault();switch(p){case h.ROTATE:if(u.enableRotate===false)return;x(e);break;case h.DOLLY:if(u.enableZoom===false)return;V(e);break;case h.PAN:if(u.enablePan===false)return;I(e);break}}function ae(e){u.domElement.ownerDocument.removeEventListener("pointermove",R);u.domElement.ownerDocument.removeEventListener("pointerup",Y);if(u.enabled===false)return;_(e);u.dispatchEvent(a);p=h.NONE}function oe(e){if(u.enabled===false||u.enableZoom===false||p!==h.NONE&&p!==h.ROTATE)return;e.preventDefault();e.stopPropagation();u.dispatchEvent(n);z(e);u.dispatchEvent(a)}function re(e){if(u.enabled===false||u.enablePan===false)return;X(e)}function ie(e){if(u.enabled===false)return;e.preventDefault();switch(e.touches.length){case 1:switch(u.touches.ONE){case TOUCH.ROTATE:if(u.enableRotate===false)return;S(e);p=h.TOUCH_ROTATE;break;case TOUCH.PAN:if(u.enablePan===false)return;F(e);p=h.TOUCH_PAN;break;default:p=h.NONE}break;case 2:switch(u.touches.TWO){case TOUCH.DOLLY_PAN:if(u.enableZoom===false&&u.enablePan===false)return;K(e);p=h.TOUCH_DOLLY_PAN;break;case TOUCH.DOLLY_ROTATE:if(u.enableZoom===false&&u.enableRotate===false)return;B(e);p=h.TOUCH_DOLLY_ROTATE;break;default:p=h.NONE}break;default:p=h.NONE}if(p!==h.NONE){u.dispatchEvent(n)}}function se(e){if(u.enabled===false)return;e.preventDefault();e.stopPropagation();switch(p){case h.TOUCH_ROTATE:if(u.enableRotate===false)return;G(e);u.update();break;case h.TOUCH_PAN:if(u.enablePan===false)return;W(e);u.update();break;case h.TOUCH_DOLLY_PAN:if(u.enableZoom===false&&u.enablePan===false)return;Q(e);u.update();break;case h.TOUCH_DOLLY_ROTATE:if(u.enableZoom===false&&u.enableRotate===false)return;J(e);u.update();break;default:p=h.NONE}}function ce(e){if(u.enabled===false)return;$(e);u.dispatchEvent(a);p=h.NONE}function le(e){if(u.enabled===false)return;e.preventDefault()}u.domElement.addEventListener("contextmenu",le);u.domElement.addEventListener("pointerdown",ee);u.domElement.addEventListener("wheel",oe);u.domElement.addEventListener("touchstart",ie);u.domElement.addEventListener("touchend",ce);u.domElement.addEventListener("touchmove",se);this.update()};OrbitControls.prototype=Object.create(EventDispatcher.prototype);OrbitControls.prototype.constructor=OrbitControls;var MapControls=function(e,t){OrbitControls.call(this,e,t);this.screenSpacePanning=false;this.mouseButtons.LEFT=MOUSE.PAN;this.mouseButtons.RIGHT=MOUSE.ROTATE;this.touches.ONE=TOUCH.PAN;this.touches.TWO=TOUCH.DOLLY_ROTATE};MapControls.prototype=Object.create(EventDispatcher.prototype);MapControls.prototype.constructor=MapControls;export{OrbitControls,MapControls};